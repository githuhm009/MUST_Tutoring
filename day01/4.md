# C语言中的嵌套循环 (Nested Loops)

当一个循环结构被完整地置于另一个循环结构内部时，就形成了嵌套循环。外层的循环每执行一次，内层的循环就会完整地执行一遍。

这是一种处理二维或多维数据的标准模式，在自动化工程中应用广泛，例如处理图像像素、扫描传感器矩阵或控制机械臂在平面上移动。

## 嵌套循环是如何工作的？

最常见的嵌套循环是 `for` 循环嵌套 `for` 循环。

### 语法结构

```c
// 外层循环
for (int i = 0; i < M; i++) {
    
    // 内层循环
    for (int j = 0; j < N; j++) {
        // 这部分代码会执行 M * N 次
        // 在这里，i 和 j 的组合可以看作是二维坐标 (i, j)
    }
    
}
```

**执行流程**:
1.  外层循环的 `i` 初始化为 `0`。
2.  进入内层循环，内层循环的 `j` 从 `0` 开始，一直循环到 `N-1`。
3.  内层循环结束后，外层循环的 `i` 更新为 `1`。
4.  再次进入内层循环，`j` 再次从 `0` 开始，循环到 `N-1`。
5.  ...这个过程不断重复，直到外层循环的 `i` 完成所有迭代。

### 简单示例：打印乘法表

下面是一个打印9x9乘法表的经典例子，可以非常直观地展示嵌套循环的工作方式。

```c
#include <stdio.h>

int main() {
    // i 代表行
    for (int i = 1; i <= 9; i++) {
        // j 代表列
        for (int j = 1; j <= i; j++) {
            printf("%d*%d=%-2d  ", j, i, i*j); // %-2d 保证对齐
        }
        // 每打印完一行后，换行
        printf("\n");
    }
    return 0;
}
```

嵌套循环是解决这个问题的完美工具。外层循环可以用来遍历**行**，内层循环可以用来遍历**列**。

### C语言代码实现

```c
#include <stdio.h>

#define ROWS 4 // 矩阵的行数
#define COLS 5 // 矩阵的列数

// 假设这是一个函数，可以根据行列号读取对应传感器的温度
// 在实际应用中，这里会是与硬件交互的代码
float get_temperature_at(int row, int col) {
    // 为了演示，我们返回一个模拟的温度值
    // 假设 (2, 3) 位置的温度最高
    if (row == 2 && col == 3) {
        return 150.8;
    }
    return 80.0 + row * 10 + col * 2;
}

int main() {
    float temperature_matrix[ROWS][COLS];
    float max_temp = -100.0; // 初始化为一个很低的温度
    int max_temp_row = -1;
    int max_temp_col = -1;

    printf("开始扫描 %dx%d 传感器矩阵...\n", ROWS, COLS);

    // 外层循环遍历行 (i)
    for (int i = 0; i < ROWS; i++) {
        // 内层循环遍历列 (j)
        for (int j = 0; j < COLS; j++) {
            // 1. 读取数据
            temperature_matrix[i][j] = get_temperature_at(i, j);
            printf("读取位置 (%d, %d) 的温度: %.2f°C\n", i, j, temperature_matrix[i][j]);

            // 2. 比较并更新最大值
            if (temperature_matrix[i][j] > max_temp) {
                max_temp = temperature_matrix[i][j];
                max_temp_row = i;
                max_temp_col = j;
            }
        }
    }

    printf("\n扫描完成！\n");
    printf("最高温度为: %.2f°C，位于传感器 (%d, %d)。\n", max_temp, max_temp_row, max_temp_col);

    return 0;
}
```

## 复杂度警示

正如在[时空复杂度分析](/day01/ts.md)中提到的，嵌套循环通常会导致时间复杂度升高。

*   一个两层嵌套循环，如果内外循环的次数都与 `n` 相关，其时间复杂度通常为O(n²)。
*   一个三层嵌套循环，复杂度则为 O(n³)。

在实时控制系统中，必须谨慎使用嵌套循环。要确保在最坏情况下，`M * N` 次循环的总执行时间仍然在系统允许的时间片（如一个控制周期）之内，否则会造成系统延迟或任务超时。

## 总结

1.  **核心思想**: 嵌套循环是处理二维或多维数据的基本模式，外层循环控制一个维度（如行），内层循环控制另一个维度（如列）。
2.  **执行次数**: 总执行次数等于外层循环次数乘以内层循环次数。
3.  **应用场景**: 遍历数组矩阵、处理图像像素、生成数据表格等。
4.  **性能考量**: 注意其带来的时间复杂度，在性能敏感的自动化程序中需要评估其执行时间。